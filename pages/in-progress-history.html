<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>In-Progress Thoughts History</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <header>
    <h1>In-Progress Thoughts History</h1>
    <nav>
      <a href="../index.html">Home</a>
      <a href="ideas.html">Ideas</a>
      <a href="writings.html">Writings</a>
    </nav>
  </header>

  <main>
    <section class="content-blocks">
      <div class="block">
        <h3>All In-Progress Thoughts</h3>
        <div id="fullProgressList"></div>
      </div>
    </section>
  </main>
  
  <section class="storage-meter">
  <p id="storageInfo">Calculating storage...</p>
</section>

  <footer>
  
  <div class="disclaimer-popover">
  <span class="disclaimer-label">Disclaimer</span>
  <div class="disclaimer-box">
    <p><strong>Local Storage Only:</strong> All your writings are saved in your browser. Nothing is uploaded or shared.</p>
    <ul>
      <li><strong>Private</strong> â€“ Your entries never leave your device.</li>
      <li><strong>Offline-friendly</strong> â€“ Works without internet once loaded.</li>
      <li><strong>5MB Limit</strong> â€“ Uses local storage (~5MB available).</li>
      <li><strong>No Backup</strong> â€“ Clearing browser data erases all entries.</li>
    </ul>
  </div>
</div>
  
    <p>&copy; 2025 My Freeform. All rights reserved.</p>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // ============================
    // ðŸ“ IN-PROGRESS HISTORY
    // ============================
    const container = document.getElementById("fullProgressList");
    let allProgress = JSON.parse(localStorage.getItem("inProgress")) || [];

    const renderProgressHistory = () => {
      container.innerHTML = "";

      if (allProgress.length === 0) {
        container.innerHTML = "<p>No thoughts saved yet.</p>";
        return;
      }

      // Render newest first
      allProgress.slice().reverse().forEach((text, indexFromEnd) => {
        const index = allProgress.length - 1 - indexFromEnd;

        const box = document.createElement("div");
        box.className = "entry-box";

        const p = document.createElement("p");
        p.className = "entry-text";
        p.textContent = text;

        const delBtn = document.createElement("button");
        delBtn.className = "delete-entry-btn";
        delBtn.textContent = "Delete";
        delBtn.onclick = () => {
          if (confirm("Are you sure you want to delete this idea?")) {
            allProgress.splice(index, 1);
            localStorage.setItem("inProgress", JSON.stringify(allProgress));
            renderProgressHistory();
            updateStorageInfo();
          }
        };

        box.appendChild(p);
        box.appendChild(delBtn);
        container.appendChild(box);
      });
    };

    // ========================
    // ðŸ’¾ STORAGE USAGE DISPLAY
    // ========================
    function getStorageSize(key) {
      const item = localStorage.getItem(key);
      return item ? new Blob([item]).size : 0;
    }

    function updateStorageInfo() {
      const beliefsSize = getStorageSize("beliefs");
      const progressSize = getStorageSize("inProgress");
      const totalUsed = beliefsSize + progressSize;

      const maxStorage = 5 * 1024 * 1024; // ~5MB
      const usedKB = (totalUsed / 1024).toFixed(1);
      const freeKB = ((maxStorage - totalUsed) / 1024).toFixed(1);
      const percentUsed = ((totalUsed / maxStorage) * 100).toFixed(2);

      const infoEl = document.getElementById("storageInfo");
      if (infoEl) {
        infoEl.innerHTML = `
          <strong>Storage Used:</strong> ${usedKB} KB 
          &nbsp;|&nbsp; 
          <strong>Free:</strong> ${freeKB} KB 
          &nbsp;|&nbsp; 
          <strong>${percentUsed}% of 5MB</strong>
        `;
      }
    }

    renderProgressHistory();
    updateStorageInfo();
  });
</script>

</body>
</html>
