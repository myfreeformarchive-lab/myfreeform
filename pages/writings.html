<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writings - My Freeform</title>
  <link rel="icon" href="../icon.png" sizes="512x512">
  <link rel="apple-touch-icon" href="../icon.png">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <header>
    <h1>Writings</h1>
    <nav>
      <a href="../index.html">Home</a>
      <a href="ideas.html">Ideas</a>
      <a href="writings.html" class="active">Writings</a>
    </nav>
  </header>

  <main>
    <section class="intro">
      <p>A growing collection of longer writings and essays.</p>
    </section>
	
		<!-- üîÑ Real Toggle Switch -->
<div class="public-mode-toggle">
  <label class="switch">
    <input type="checkbox" id="publicModeToggle">
    <span class="slider"></span>
  </label>
  <span id="publicModeLabel">Public Mode: OFF</span>
</div>

    <section class="content-blocks">
      <div class="block">
        <h3>Submit New Writing</h3>
        <input type="text" id="writingTitle" placeholder="Title" style="width: 100%; padding: 8px; margin-bottom: 10px;" />
        <textarea id="writingContent" placeholder="Your full writing here..." rows="6"></textarea>
        <button id="addWritingBtn">Post Writing</button>

        <div id="writingList"></div>

        <a href="writing-history.html" class="view-history-link">View All Writings ‚Üí</a>
      </div>
    </section>
  </main>

  <section class="storage-meter">
    <p id="storageInfo">Calculating storage...</p>
  </section>

  <footer>
  
  <div class="disclaimer-popover">
  <span class="disclaimer-label">Disclaimer</span>
  <div class="disclaimer-box">
    <p><strong>Local Storage Only:</strong> All your writings are saved in your browser. Nothing is uploaded or shared.</p>
    <ul>
      <li><strong>Private</strong> ‚Äì Your entries never leave your device.</li>
      <li><strong>Offline-friendly</strong> ‚Äì Works without internet once loaded.</li>
      <li><strong>5MB Limit</strong> ‚Äì Uses local storage (~5MB available).</li>
      <li><strong>No Backup</strong> ‚Äì Clearing browser data erases all entries.</li>
    </ul>
  </div>
</div>
  
    <p>&copy; 2025 My Freeform. All rights reserved.</p>
  </footer>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBD-8hcoAuTFaAhgSy-WIyQX_iI37uokTw",
    authDomain: "myfreeformarchive-8a786.firebaseapp.com",
    projectId: "myfreeformarchive-8a786",
    storageBucket: "myfreeformarchive-8a786.appspot.com",
    messagingSenderId: "16237442482",
    appId: "1:16237442482:web:424f8f2e344a58e7f6a0ab"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("fullWritingList");
  let allWritings = JSON.parse(localStorage.getItem("writings")) || [];

  const renderWritingHistory = () => {
    container.innerHTML = "";

    if (allWritings.length === 0) {
      container.innerHTML = "<p>No writings saved yet.</p>";
      return;
    }

    allWritings.slice().reverse().forEach((item, indexFromEnd) => {
      const index = allWritings.length - 1 - indexFromEnd;
      const title = item.title;
      const content = item.content;
      const date = item.date;

      const box = document.createElement("div");
      box.className = "entry-box";

      const titleEl = document.createElement("p");
      titleEl.className = "entry-text writing-title";
      titleEl.textContent = title;

      const dateEl = document.createElement("p");
      dateEl.className = "entry-text writing-date";
      dateEl.textContent = `Date: ${date}`;

      const contentEl = document.createElement("p");
      contentEl.className = "entry-text writing-content";
      contentEl.textContent = content;

      const delBtn = document.createElement("button");
      delBtn.className = "delete-entry-btn";
      delBtn.textContent = "Delete";

      delBtn.onclick = async () => {
        if (!confirm("Delete this writing?")) return;

        const publicMode = localStorage.getItem("publicModeEnabled") === "true";

        // üî• Delete from Firestore if public mode is on and ID exists
        if (publicMode && item.firebaseId && typeof db !== "undefined") {
          try {
            await db.collection("publicWritings").doc(item.firebaseId).delete();
            console.log("üî• Deleted from Firestore:", item.firebaseId);
          } catch (err) {
            console.error("‚ùå Firebase delete failed:", err);
          }
        }

        // üíæ Always delete locally
        allWritings.splice(index, 1);
        localStorage.setItem("writings", JSON.stringify(allWritings));
        renderWritingHistory();
        updateStorageInfo();
      };

      box.appendChild(titleEl);
      box.appendChild(dateEl);
      box.appendChild(contentEl);
      box.appendChild(delBtn);
      container.appendChild(box);
    });
  };

  function getStorageSize(key) {
    const item = localStorage.getItem(key);
    return item ? new Blob([item]).size : 0;
  }

  function updateStorageInfo() {
    const beliefsSize = getStorageSize("beliefs");
    const progressSize = getStorageSize("inProgress");
    const ideasSize = getStorageSize("ideas");
    const writingsSize = getStorageSize("writings");
    const totalUsed = beliefsSize + progressSize + ideasSize + writingsSize;

    const maxStorage = 5 * 1024 * 1024;
    const usedKB = (totalUsed / 1024).toFixed(1);
    const freeKB = ((maxStorage - totalUsed) / 1024).toFixed(1);
    const percentUsed = ((totalUsed / maxStorage) * 100).toFixed(2);

    const infoEl = document.getElementById("storageInfo");
    if (infoEl) {
      infoEl.innerHTML = `
        <strong>Storage Used:</strong> ${usedKB} KB 
        &nbsp;|&nbsp; 
        <strong>Free:</strong> ${freeKB} KB 
        &nbsp;|&nbsp; 
        <strong>${percentUsed}% of 5MB</strong>
      `;
    }
  }

  renderWritingHistory();
  updateStorageInfo();
});
</script>


</body>
</html>
